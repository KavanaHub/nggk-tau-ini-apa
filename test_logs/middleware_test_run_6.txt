
> nggk-tau-ini-apa@1.0.0 test
> cross-env NODE_ENV=test node --experimental-vm-modules node_modules/jest/bin/jest.js --coverage --passWithNoTests --testPathPattern=unit/middleware.test.js --no-cache

node.exe : [baseline-b
rowser-mapping] The 
data in this module 
is over two months 
old.  To ensure 
accurate Baseline 
data, please update: 
`npm i baseline-browse
r-mapping@latest -D`
At line:1 char:1
+ & "D:\ENV\NodeJS/nod
e.exe" "C:\Users\Renz\
AppData\Roaming\npm/no
de_mo ...
+ ~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~
~~~~~
    + CategoryInfo    
          : NotSpeci  
  fied: ([baseline-   
 brows...ping@late    
st -D`:String) []    
, RemoteException
    + FullyQualifiedE 
   rrorId : NativeCo  
  mmandError
 
  console.log
    [dotenv@17.2.3] injecting env (9) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:6424) 
ExperimentalWarning: 
VM Modules is an 
experimental feature 
and might change at 
any time
(Use `node 
--trace-warnings ...` 
to show where the 
warning was created)
FAIL __tests__/unit/mi
ddleware.test.js
  Middleware Unit 
Tests
    Auth Middleware
      √ should return 
401 if no auth header 
(6 ms)
      √ should return 
401 if invalid header 
format (1 ms)
      √ should return 
401 if token invalid 
(1 ms)
      √ should call 
next and set user if 
token valid (6 ms)
    Role Middleware
      requireRole
        √ should 
return 403 if no user 
(1 ms)
        √ should 
allow admin (1 ms)
        √ should 
allow correct role (1 
ms)
        √ should 
return 403 for 
mismatch (1 ms)
        √ should 
allow Koordinator to 
Dosen (1 ms)
        √ should 
allow Kaprodi to 
Dosen/Koordinator (1 
ms)
      kaprodiOnly
        √ should 
allow kaprodi (1 ms)
        √ should 
block admin (1 ms)
    Upload Middleware
      parseMultipart
        √ should skip 
if req.file exists (1 
ms)
        √ should skip 
if not multipart
        × should 
parse fields and 
files via Busboy (4 
ms)
        × should 
handle busboy errors 
(1 ms)

  ● Middleware Unit 
Tests › Upload 
Middleware › 
parseMultipart › 
should parse fields 
and files via Busboy

    expect(jest.fn()).
toHaveBeenCalled()

    Expected number 
of calls: >= 1
    Received number 
of calls:    0

    [0m [90m 178 
|[39m
     [90m 179 |[39m 
                
[90m// Check if 
busboy was 
instantiated[39m
    [31m[1m>[22m[3
9m[90m 180 |[39m    
             expect(mo
ckBusboyConstructor)[
33m.[39mtoHaveBeenCal
led()[33m;[39m
     [90m     |[39m 
                      
                      
  [31m[1m^[22m[39m
     [90m 181 |[39m
     [90m 182 |[39m 
                
[90m// Capture 
callbacks[39m
     [90m 183 |[39m 
                
[36mconst[39m calls 
[33m=[39m mockBusboy
Instance[33m.[39mon
[33m.[39mmock[33m.[
39mcalls[33m;[39m[0
m

      at 
Object.<anonymous> (__
tests__/unit/middlewar
e.test.js:180:47)

  ● Middleware Unit 
Tests › Upload 
Middleware › 
parseMultipart › 
should handle busboy 
errors

    expect(jest.fn()).
toHaveBeenCalledWith(.
..expected)

    Expected: [Error: 
Busboy failed]

    Number of calls: 0

    [0m [90m 227 
|[39m                
 [36mif[39m (callbac
ks[[32m'error'[39m])
 callbacks[[32m'error
'[39m](error)[33m;[
39m
     [90m 228 |[39m
    [31m[1m>[22m[3
9m[90m 229 |[39m    
             expect(mo
ckNext)[33m.[39mtoHa
veBeenCalledWith(error
)[33m;[39m
     [90m     |[39m 
                      
           
[31m[1m^[22m[39m
     [90m 230 |[39m 
            
})[33m;[39m
     [90m 231 |[39m 
        })[33m;[39m
     [90m 232 |[39m 
    })[33m;[39m[0m

      at 
Object.<anonymous> (__
tests__/unit/middlewar
e.test.js:229:34)

----------------------------|---------|----------|---------|---------|-------------------------
File                        | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s       
----------------------------|---------|----------|---------|---------|-------------------------
All files                   |    3.48 |     5.46 |    4.25 |    3.59 |                         
 controllers                |       0 |        0 |       0 |       0 |                         
  adminController.js        |       0 |        0 |       0 |       0 | 3-285                   
  authController.js         |       0 |        0 |       0 |       0 | 6-278                   
  bimbinganController.js    |       0 |        0 |       0 |       0 | 3-170                   
  dosenController.js        |       0 |        0 |       0 |       0 | 4-156                   
  jadwalController.js       |       0 |        0 |       0 |       0 | 3-197                   
  kaprodiController.js      |       0 |        0 |       0 |       0 | 4-376                   
  kelompokController.js     |       0 |        0 |       0 |       0 | 3-209                   
  koordinatorController.js  |       0 |        0 |       0 |       0 | 5-192                   
  mahasiswaController.js    |       0 |        0 |       0 |       0 | 4-391                   
  notificationController.js |       0 |        0 |       0 |       0 | 3-72                    
  sharedController.js       |       0 |        0 |       0 |       0 | 8-253                   
  sidangController.js       |       0 |        0 |       0 |       0 | 3-336                   
 middleware                 |   77.04 |    91.66 |      50 |   77.04 |                         
  auth.js                   |     100 |      100 |     100 |     100 |                         
  role.js                   |      95 |    95.45 |     100 |      95 | 43                      
  upload.js                 |   55.17 |       75 |   14.28 |   55.17 | 30-38,49,53-55,59-60,65 
 routes                     |       0 |        0 |       0 |       0 |                         
  adminRoutes.js            |       0 |      100 |     100 |       0 | 6-28                    
  authRoutes.js             |       0 |      100 |     100 |       0 | 5-21                    
  bimbinganRoutes.js        |       0 |        0 |       0 |       0 | 8-40                    
  dosenRoutes.js            |       0 |      100 |     100 |       0 | 8-32                    
  kaprodiRoutes.js          |       0 |      100 |     100 |       0 | 6-27                    
  koordinatorRoutes.js      |       0 |      100 |     100 |       0 | 8-40                    
  mahasiswaRoutes.js        |       0 |      100 |     100 |       0 | 9-42                    
  notificationRoutes.js     |       0 |      100 |     100 |       0 | 5-8                     
  pengujiRoutes.js          |       0 |        0 |       0 |       0 | 6-45                    
  profileRoutes.js          |       0 |        0 |       0 |       0 | 7-63                    
  proposalRoutes.js         |       0 |        0 |       0 |       0 | 8-58                    
  reportRoutes.js           |       0 |        0 |       0 |       0 | 8-51                    
  sidangRoutes.js           |       0 |      100 |       0 |       0 | 8-30                    
 utils                      |       0 |        0 |       0 |       0 |                         
  constants.js              |       0 |        0 |       0 |       0 | 6-71                    
  gcs.js                    |       0 |        0 |       0 |       0 | 3-42                    
  gdrive.js                 |       0 |        0 |       0 |       0 | 12-191                  
  httpResponses.js          |       0 |        0 |       0 |       0 | 6-54                    
  jwt.js                    |       0 |        0 |       0 |       0 | 4-7                     
  password.js               |       0 |      100 |       0 |       0 | 4-9                     
  roleHelper.js             |       0 |        0 |       0 |       0 | 13-157                  
----------------------------|---------|----------|---------|---------|-------------------------
Test Suites: 1 
failed, 1 total
Tests:       2 
failed, 14 passed, 16 
total
Snapshots:   0 total
Time:        4.285 s
Ran all test suites 
matching /unit\\middle
ware.test.js/i.
