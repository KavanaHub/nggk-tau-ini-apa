
> nggk-tau-ini-apa@1.0.0 test
> cross-env NODE_ENV=test node --experimental-vm-modules node_modules/jest/bin/jest.js --coverage --passWithNoTests --testPathPattern=unit/controllers.test.js --no-cache

  console.log
    [dotenv@17.2.3] injecting env (9) from .env -- tip: ⚙️  suppress all logs with { quiet: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

node.exe : [baseline-b
rowser-mapping] The 
data in this module 
is over two months 
old.  To ensure 
accurate Baseline 
data, please update: 
`npm i baseline-browse
r-mapping@latest -D`
At line:1 char:1
+ & "D:\ENV\NodeJS/nod
e.exe" "C:\Users\Renz\
AppData\Roaming\npm/no
de_mo ...
+ ~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~~
~~~~~
    + CategoryInfo    
          : NotSpeci  
  fied: ([baseline-   
 brows...ping@late    
st -D`:String) []    
, RemoteException
    + FullyQualifiedE 
   rrorId : NativeCo  
  mmandError
 
  console.log
    [dotenv@17.2.3] injecting env (0) from .env -- tip: 🔐 prevent committing .env to code: https://dotenvx.com/precommit

      at _log (node_modules/dotenv/lib/main.js:142:11)

(node:1364) 
ExperimentalWarning: 
VM Modules is an 
experimental feature 
and might change at 
any time
(Use `node 
--trace-warnings ...` 
to show where the 
warning was created)
  console.log
    Error checking dosen: undefined is not iterable (cannot read property Symbol(Symbol.iterator))

      at Object.log [as login] (controllers/authController.js:85:19)

  console.log
    Error checking dosen (fallback): undefined is not iterable (cannot read property Symbol(Symbol.iterator))

      at Object.log [as login] (controllers/authController.js:93:21)

  console.log
    Running database schema fix...

      at Object.log [as runSchemaFix] (controllers/authController.js:251:15)

  console.error
    Complete jadwal error: TypeError: undefined is not iterable (cannot read property Symbol(Symbol.iterator))
        at Object.complete (D:\Kegabutan\kavanahub\nggk-tau-ini-apa\controllers\jadwalController.js:157:19)
        at Object.<anonymous> (D:\Kegabutan\kavanahub\nggk-tau-ini-apa\__tests__\unit\controllers.test.js:919:17)

    [0m [90m 192 |[39m     } [36mcatch[39m (err) {
     [90m 193 |[39m       [36mawait[39m conn[33m.[39mrollback()[33m;[39m
    [31m[1m>[22m[39m[90m 194 |[39m       console[33m.[39merror([32m'Complete jadwal error:'[39m[33m,[39m err)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 195 |[39m       next(err)[33m;[39m
     [90m 196 |[39m     } [36mfinally[39m {
     [90m 197 |[39m       conn[33m.[39mrelease()[33m;[39m[0m

      at Object.error [as complete] (controllers/jadwalController.js:194:15)
      at Object.<anonymous> (__tests__/unit/controllers.test.js:919:17)

FAIL __tests__/unit/co
ntrollers.test.js
  Controller Unit 
Tests
    AuthController
      login
        √ should 
return 400 if fields 
missing (3 ms)
        √ should 
login successfully 
for Mahasiswa (155 ms)
        √ should 
return 400 if user 
not found (8 ms)
      
registerMahasiswa
        √ should 
register new 
mahasiswa 
successfully (78 ms)
        √ should 
return 400 if email 
already exists
      getProfile
        √ should 
return mahasiswa 
profile (1 ms)
        √ should 
return dosen profile 
with roles
        √ should 
return admin profile
      updateProfile
        √ should 
update mahasiswa 
profile (1 ms)
        √ should 
update dosen profile
      changePassword
        √ should 
change password 
successfully (194 ms)
        √ should 
return 401 if old 
password incorrect 
(126 ms)
      runSchemaFix
        √ should run 
schema fix 
successfully (2 ms)
    
MahasiswaController
      getProfile
        √ should 
return profile with 
dosen info
        √ should 
return 404 if not 
found (1 ms)
      submitProposal
        √ should 
submit proposal 
successfully
        √ should 
return 400 if track 
not set
      getBimbinganList
        √ should 
return list of 
bimbingan (1 ms)
      setTrack
        √ should set 
track successfully 
(no partner)
        √ should fail 
if track already set 
(1 ms)
      
getProposalStatus
        √ should 
return proposal status
      getDosen
        √ should 
return dosen 
pembimbing info
      getPeriodeAktif
        √ should 
return active periode
        √ should 
return active: false 
if no periode found
    AdminController
      getStats
        √ should 
return dashboard 
stats (1 ms)
      
getRecentActivity
        √ should 
return combined 
recent activities
      getAllUsers
        √ should 
return merged user 
list (1 ms)
      getAllDosen
        √ should 
return all dosen
      createDosen
        √ should 
create dosen 
successfully with 
roles (64 ms)
        √ should 
return 400 if email 
exists (1 ms)
      updateUserStatus
        √ should 
update mahasiswa 
status
      deleteUser
        √ should 
delete user (1 ms)
      getSystemReport
        √ should 
return system report
    DosenController
      getProfile
        √ should 
return profile with 
roles (1 ms)
      
getMahasiswaBimbingan
        √ should 
return mahasiswa list
      getBimbinganList
        √ should 
return all bimbingan
      getLaporanSidang
        √ should 
return laporan sidang 
list (1 ms)
      getMySidang
        √ should 
return sidang 
schedule as penguji
      getStats
        √ should 
return dosen 
dashboard stats
    
BimbinganController
      createBimbingan
        √ should 
create bimbingan 
successfully (1 ms)
      
getDosenBimbingan
        √ should 
return list of 
bimbingan for dosen
      getMyBimbingan
        √ should 
return list of own 
bimbingan
      
updateBimbinganStatus
        √ should 
approve bimbingan 
successfully (1 ms)
        √ should 
return 400 if status 
invalid
      getBimbinganById
        √ should 
return bimbingan 
detail
        √ should 
return 404 if not 
found
    JadwalController
      getActive
        √ should 
return active 
schedules (1 ms)
      create
        √ should 
create new jadwal
      list
        √ should 
return all schedules
      update
        √ should 
update jadwal 
successfully (1 ms)
      complete
        × should 
complete active 
jadwal and remove 
koordinator role (16 
ms)
    KelompokController
      createKelompok
        √ should 
create kelompok 
successfully (1 ms)
      joinKelompok
        √ should join 
kelompok successfully
      getMyKelompok
        √ should 
return my kelompok
      getAllKelompok
        √ should 
return all kelompok
      
getAvailableKelompok
        √ should 
return available 
kelompok for track (1 
ms)
    
KoordinatorController
      getProfile
        √ should 
return koordinator 
profile
      
getAssignedSemester
        √ should 
return assigned 
semester
      
getPendingProposals
        √ should 
return pending 
proposals grouped by 
kelompok (1 ms)
      getPengujiList
        √ should 
return list of penguji
      getStats
        √ should 
return koordinator 
stats
    KaprodiController
      
getRecentActivities
        √ should 
return combined 
activities (1 ms)
      assignKoordinato
rSemester
        √ should 
assign koordinator 
successfully (1 ms)
      unassignKoordina
torSemester
        √ should 
unassign koordinator
      
getDashboardStats
        √ should 
return kaprodi 
dashboard stats (1 ms)
    
NotificationController
      getStats
        √ should 
return notification 
stats for Dosen
    SidangController
      submitLaporan
        √ should 
submit laporan 
successfully (1 ms)
      scheduleSidang
        √ should 
schedule sidang 
successfully
      getMyLaporan
        √ should 
return my laporan
      getDosenLaporan
        √ should 
return grouped 
laporan for dosen
      
updateLaporanStatus
        √ should 
update laporan status 
for group (1 ms)
      getAllSidang
        √ should 
return all sidang (1 
ms)
      getMySidang
        √ should 
return my sidang
    SharedController
      assignDosen
        √ should 
assign dosen to 
mahasiswa (1 ms)

  ● Controller Unit 
Tests › 
JadwalController › 
complete › should 
complete active 
jadwal and remove 
koordinator role

    expect(jest.fn()).
toHaveBeenCalledWith(.
..expected)

    Expected: 
ObjectContaining 
{"message": 
StringContaining 
"berhasil"}

    Number of calls: 0

    [0m [90m 919 
|[39m                
 [36mawait[39m jadwa
lController[33m.[39m
complete(req[33m,[39
m res[33m,[39m 
mockNext)[33m;[39m
     [90m 920 |[39m
    [31m[1m>[22m[3
9m[90m 921 |[39m    
             expect(re
s[33m.[39mjson)[33m
.[39mtoHaveBeenCalled
With(expect[33m.[39m
objectContaining({ 
message[33m:[39m exp
ect[33m.[39mstringCo
ntaining([32m'berhasi
l'[39m) 
}))[33m;[39m
     [90m     |[39m 
                      
           
[31m[1m^[22m[39m
     [90m 922 |[39m 
                expect
(mockConnection[33m.
[39mcommit)[33m.[39m
toHaveBeenCalled()[33
m;[39m
     [90m 923 |[39m 
            
})[33m;[39m
     [90m 924 |[39m 
        
})[33m;[39m[0m

      at 
Object.<anonymous> (__
tests__/unit/controlle
rs.test.js:921:34)

----------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------
File                        | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                     
----------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------
All files                   |    48.1 |    41.39 |   48.93 |   48.66 |                                                                                                       
 controllers                |   66.84 |    55.08 |   75.86 |   67.85 |                                                                                                       
  adminController.js        |   84.03 |    66.66 |   81.81 |   82.88 | 6,22,27,37,46,86,123,138,151,155,169,216-232,246,260,285                                              
  authController.js         |   72.97 |    60.81 |     100 |   72.97 | 22,34,51-52,63,68,105,111-112,136,141,150,155,177-188,192,197,208,212,221-226,230,243,277-278         
  bimbinganController.js    |   76.92 |       68 |     100 |   76.92 | 10,21,25,35,49,64,85,108,119,134,146,170                                                              
  dosenController.js        |   80.55 |       50 |     100 |   80.55 | 17,22,51,70,89,110,156                                                                                
  jadwalController.js       |   62.16 |     61.7 |     100 |   62.16 | 13,28,36,42,58,70,81,89,92,101,112,121,127,130,141,146,161-191                                        
  kaprodiController.js      |   66.66 |       50 |      40 |   71.42 | 8-38,71,82,91,135,157,174,191,208,226,244,264,282,289,300,306,315,327,352,363,376                     
  kelompokController.js     |   71.21 |    53.33 |     100 |   71.21 | 10,21,25,29,36,59,69,80,84,88,100,105,115,126,145,159,175,191,209                                     
  koordinatorController.js  |   82.69 |    66.66 |     100 |   84.31 | 19,29,46,55,68,147,175,192                                                                            
  mahasiswaController.js    |   64.03 |    58.57 |    87.5 |   64.03 | 30-49,61,77-78,99-135,143,158-159,172,189,197-203,211-217,230,245,250,271,296,316,335,340,358,365,391 
  notificationController.js |   54.16 |       40 |     100 |   59.09 | 39-48,55-67,72                                                                                        
  sharedController.js       |   20.48 |    30.35 |   11.11 |   20.98 | 12-145,154,161,171,177,182-188,194-198,208-253                                                        
  sidangController.js       |   66.66 |    50.94 |      90 |   70.27 | 11,32-33,46-51,65,81,97,162-163,208,219,230,234,250,257,270-296,316,336                               
 middleware                 |       0 |        0 |       0 |       0 |                                                                                                       
  auth.js                   |       0 |        0 |       0 |       0 | 4-22                                                                                                  
  role.js                   |       0 |        0 |       0 |       0 | 5-50                                                                                                  
  upload.js                 |       0 |        0 |       0 |       0 | 4-67                                                                                                  
 routes                     |       0 |        0 |       0 |       0 |                                                                                                       
  adminRoutes.js            |       0 |      100 |     100 |       0 | 6-28                                                                                                  
  authRoutes.js             |       0 |      100 |     100 |       0 | 5-21                                                                                                  
  bimbinganRoutes.js        |       0 |        0 |       0 |       0 | 8-40                                                                                                  
  dosenRoutes.js            |       0 |      100 |     100 |       0 | 8-32                                                                                                  
  kaprodiRoutes.js          |       0 |      100 |     100 |       0 | 6-27                                                                                                  
  koordinatorRoutes.js      |       0 |      100 |     100 |       0 | 8-40                                                                                                  
  mahasiswaRoutes.js        |       0 |      100 |     100 |       0 | 9-42                                                                                                  
  notificationRoutes.js     |       0 |      100 |     100 |       0 | 5-8                                                                                                   
  pengujiRoutes.js          |       0 |        0 |       0 |       0 | 6-45                                                                                                  
  profileRoutes.js          |       0 |        0 |       0 |       0 | 7-63                                                                                                  
  proposalRoutes.js         |       0 |        0 |       0 |       0 | 8-58                                                                                                  
  reportRoutes.js           |       0 |        0 |       0 |       0 | 8-51                                                                                                  
  sidangRoutes.js           |       0 |      100 |       0 |       0 | 8-30                                                                                                  
 utils                      |     5.4 |     1.28 |    8.57 |    5.71 |                                                                                                       
  constants.js              |   17.64 |        0 |       0 |   18.75 | 25-26,40-71                                                                                           
  gcs.js                    |       0 |        0 |       0 |       0 | 3-42                                                                                                  
  gdrive.js                 |       0 |        0 |       0 |       0 | 12-191                                                                                                
  httpResponses.js          |       0 |        0 |       0 |       0 | 6-54                                                                                                  
  jwt.js                    |     100 |       50 |     100 |     100 | 13                                                                                                    
  password.js               |     100 |      100 |     100 |     100 |                                                                                                       
  roleHelper.js             |       0 |        0 |       0 |       0 | 13-157                                                                                                
----------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------
Test Suites: 1 
failed, 1 total
Tests:       1 
failed, 73 passed, 74 
total
Snapshots:   0 total
Time:        3.745 s
Ran all test suites 
matching /unit\\contro
llers.test.js/i.
